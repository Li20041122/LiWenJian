# 图书借阅管理系统 - 开发文档

## 📋 目录
- [项目简介](#项目简介)
- [技术栈](#技术栈)
- [环境准备](#环境准备)
- [在IDEA中打开和运行项目](#在idea中打开和运行项目)
- [数据库配置](#数据库配置)
- [启动步骤](#启动步骤)
- [功能说明](#功能说明)
- [常见问题](#常见问题)

---

## 项目简介

这是一个基于 **SpringBoot + Vue3** 的前后端分离图书借阅管理系统，实现了图书管理、用户管理、借阅管理和部门管理的完整功能。

### 项目结构

```
book/                               # 项目根目录
├── src/main/java/edu/fosu/book/   # 后端Java代码
│   ├── controller/                 # 控制器层（API接口）
│   │   ├── BookController.java
│   │   ├── UserController.java
│   │   ├── BorrowController.java
│   │   └── DepartController.java
│   ├── service/                    # 服务接口层
│   │   └── impl/                   # 服务实现层
│   ├── dao/                        # 数据访问层（Mapper）
│   ├── entity/                     # 实体类
│   └── config/                     # 配置类（CORS等）
├── src/main/resources/
│   ├── mapper/                     # MyBatis XML映射文件
│   └── application.properties      # SpringBoot配置文件
├── frontend/                       # 前端Vue项目
│   ├── src/
│   │   ├── views/                  # 页面组件
│   │   ├── api/                    # API接口封装
│   │   ├── router/                 # 路由配置
│   │   └── App.vue                 # 主组件
│   ├── package.json                # 前端依赖配置
│   └── vite.config.js             # Vite配置
├── pom.xml                         # Maven配置文件
└── 数据库脚本.sql                  # 数据库初始化脚本
```

---

## 技术栈

### 后端
- **SpringBoot 3.5.8** - Web应用框架
- **MyBatis 3.0.5** - 持久层框架
- **MySQL 8.0+** - 数据库
- **Maven** - 项目管理工具

### 前端
- **Vue 3.4** - 渐进式JavaScript框架
- **Element Plus 2.5** - UI组件库
- **Vite 5.0** - 前端构建工具
- **Axios 1.6** - HTTP请求库
- **Vue Router 4.2** - 路由管理

---

## 环境准备

在开始之前，请确保你的电脑已安装以下软件：

### 必需软件

1. **JDK 17+**
   - 下载地址：https://www.oracle.com/java/technologies/downloads/
   - 配置环境变量 `JAVA_HOME`

2. **MySQL 8.0+**
   - 下载地址：https://dev.mysql.com/downloads/mysql/
   - 记住root密码（默认配置为123456）

3. **Node.js 18+**
   - 下载地址：https://nodejs.org/
   - 会自动安装npm

4. **IntelliJ IDEA**
   - 推荐使用Ultimate版（支持Spring Boot）
   - 下载地址：https://www.jetbrains.com/idea/download/

### 可选软件

- **Navicat / DBeaver** - 数据库管理工具（可选）
- **Postman** - API测试工具（可选）

---

## 在IDEA中打开和运行项目

### 步骤1：导入后端项目

1. **打开IntelliJ IDEA**

2. **导入项目**
   - 点击 `File` → `Open`
   - 选择项目根目录 `D:\08课程文件\大三Web开发技术\实验四\book`
   - 点击 `OK`

3. **等待Maven依赖下载**
   - IDEA会自动识别为Maven项目
   - 右下角会显示下载进度
   - 首次下载可能需要5-10分钟，请耐心等待
   - 如果下载失败，可以：
     - 点击右侧 `Maven` 面板
     - 点击刷新按钮（圆形箭头图标）

4. **配置JDK**
   - 点击 `File` → `Project Structure`
   - 在 `Project` 选项卡中
   - 设置 `SDK` 为 JDK 17 或更高版本
   - 点击 `Apply` → `OK`

### 步骤2：配置数据库

#### 2.1 创建数据库

**方法一：使用MySQL命令行**

```bash
# 打开命令行，登录MySQL
mysql -u root -p

# 输入密码后，执行以下SQL
CREATE DATABASE IF NOT EXISTS book;
USE book;
```

**方法二：使用IDEA内置数据库工具**

1. 点击右侧 `Database` 面板
2. 点击 `+` → `Data Source` → `MySQL`
3. 填写连接信息：
   - Host: `localhost`
   - Port: `3306`
   - User: `root`
   - Password: `123456`（你的MySQL密码）
4. 点击 `Test Connection` 测试连接
5. 点击 `OK` 保存

#### 2.2 执行数据库脚本

**方法一：使用SQL文件**

1. 在IDEA中打开 `数据库脚本.sql` 文件
2. 右键点击文件内容
3. 选择 `Run '数据库脚本.sql'`
4. 选择刚才配置的数据源
5. 点击 `Run`

**方法二：使用MySQL命令行**

```bash
mysql -u root -p book < 数据库脚本.sql
```

#### 2.3 修改数据库配置（如需要）

打开 `src/main/resources/application.properties` 文件：

```properties
spring.application.name=Book

# 数据库连接配置（根据实际情况修改）
spring.datasource.url=jdbc:mysql://localhost:3306/book
spring.datasource.username=root
spring.datasource.password=123456  # 改成你的MySQL密码
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# 服务端口
server.port=8081

# MyBatis配置
mybatis.mapper-locations=classpath:mapper/*.xml
```

### 步骤3：启动后端服务

#### 方法一：使用IDEA运行按钮（推荐）

1. **找到主类**
   - 打开 `src/main/java/edu/fosu/book/BookApplication.java`

2. **运行主类**
   - 点击类名左侧的绿色三角形按钮
   - 选择 `Run 'BookApplication'`

3. **确认启动成功**
   - 在控制台看到以下信息表示启动成功：
   ```
   Started BookApplication in xxx seconds
   ```
   - 后端服务运行在 `http://localhost:8081`

#### 方法二：使用Maven命令

1. 打开IDEA底部的 `Terminal` 终端
2. 执行命令：
   ```bash
   ./mvnw spring-boot:run
   ```
   或者在Windows下：
   ```bash
   mvnw.cmd spring-boot:run
   ```

#### 验证后端启动

在浏览器中访问：http://localhost:8081/book

如果返回JSON格式的图书列表，说明后端启动成功！

### 步骤4：启动前端服务

#### 4.1 安装前端依赖

1. **打开终端**
   - 在IDEA底部点击 `Terminal`
   - 或使用快捷键 `Alt + F12`

2. **进入前端目录**
   ```bash
   cd frontend
   ```

3. **安装依赖**
   ```bash
   npm install
   ```
   - 首次安装需要3-5分钟
   - 如果速度慢，可以使用国内镜像：
   ```bash
   npm config set registry https://registry.npmmirror.com
   npm install
   ```

#### 4.2 启动前端开发服务器

```bash
npm run dev
```

**成功启动的标志：**
```
VITE v5.4.21  ready in 799 ms

➜  Local:   http://localhost:3000/
➜  Network: use --host to expose
```

前端服务运行在 `http://localhost:3000`

### 步骤5：访问系统

1. **打开浏览器**
   - 推荐使用 Chrome 或 Edge

2. **访问前端地址**
   - 地址：http://localhost:3000

3. **开始使用**
   - 点击左侧菜单切换不同的管理页面
   - 图书管理、用户管理、借阅管理、部门管理

---

## 启动步骤（快速版）

### 方式一：分别启动（推荐用于开发）

**在IDEA中：**

1. **启动后端**
   - 运行 `BookApplication.java` 主类
   - 等待启动完成（看到 "Started BookApplication"）

2. **启动前端**
   - 打开Terminal，进入frontend目录
   - 执行 `npm run dev`
   - 等待启动完成

3. **访问系统**
   - 浏览器打开 http://localhost:3000

### 方式二：使用命令行启动

**后端（在项目根目录）：**
```bash
./mvnw.cmd spring-boot:run
```

**前端（新开一个终端）：**
```bash
cd frontend
npm run dev
```

---

## 功能说明

### 1. 图书管理
- ✅ 查看所有图书列表
- ✅ 添加新图书
- ✅ 编辑图书信息
- ✅ 删除图书
- 📊 数据库已预置11本图书数据

### 2. 用户管理
- ✅ 查看所有用户
- ✅ 添加新用户
- ✅ 编辑用户信息（姓名、密码、部门、电话、性别）
- ✅ 删除用户

### 3. 借阅管理
- ✅ 查看所有借阅记录
- ✅ 创建借阅记录（记录用户ID、图书ID、借阅时间）
- ✅ 更新借阅记录（记录归还时间、罚款等）
- ✅ 删除借阅记录

### 4. 部门管理
- ✅ 查看所有部门
- ✅ 添加新部门
- ✅ 编辑部门信息（支持父子部门关系）
- ✅ 删除部门

---

## RESTful API接口文档

### Book API（图书）

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /book | 获取所有图书 |
| GET | /book/{id} | 根据ID获取图书 |
| POST | /book | 添加图书 |
| PUT | /book/{id} | 更新图书 |
| DELETE | /book/{id} | 删除图书 |

**请求示例（添加图书）：**
```json
POST /book
Content-Type: application/json

{
  "bookid": "TP001",
  "bookname": "Spring实战",
  "authors": "Craig Walls",
  "publication": "人民邮电出版社",
  "publicdate": "2024-01-01",
  "price": 89.00
}
```

### User API（用户）

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /user | 获取所有用户 |
| GET | /user/{id} | 根据ID获取用户 |
| POST | /user | 添加用户 |
| PUT | /user/{id} | 更新用户 |
| DELETE | /user/{id} | 删除用户 |

**请求示例（添加用户）：**
```json
POST /user
Content-Type: application/json

{
  "userid": "U00001",
  "username": "张三",
  "password": "123456",
  "departid": "D001",
  "phonenum": "13800138000",
  "sex": "男"
}
```

### Borrow API（借阅）

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /borrow | 获取所有借阅记录 |
| GET | /borrow/{userid}/{bookid} | 根据复合主键获取 |
| POST | /borrow | 添加借阅记录 |
| PUT | /borrow/{userid}/{bookid} | 更新借阅记录 |
| DELETE | /borrow/{userid}/{bookid} | 删除借阅记录 |

**请求示例（添加借阅）：**
```json
POST /borrow
Content-Type: application/json

{
  "userid": "U00001",
  "bookid": "TP312J",
  "borrowtime": "2025-12-05T10:00:00",
  "returntime": null,
  "penalsum": 0,
  "payment": 0
}
```

### Depart API（部门）

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /depart | 获取所有部门 |
| GET | /depart/{id} | 根据ID获取部门 |
| POST | /depart | 添加部门 |
| PUT | /depart/{id} | 更新部门 |
| DELETE | /depart/{id} | 删除部门 |

**请求示例（添加部门）：**
```json
POST /depart
Content-Type: application/json

{
  "departid": "D001",
  "departname": "计算机学院",
  "parentdepartid": null
}
```

---

## 常见问题

### 1. Maven依赖下载失败

**问题：** IDEA提示无法下载Maven依赖

**解决方案：**
- 检查网络连接
- 配置Maven国内镜像（阿里云）
- 在 `pom.xml` 同级目录创建或修改 `settings.xml`：
  ```xml
  <mirrors>
    <mirror>
      <id>aliyunmaven</id>
      <mirrorOf>*</mirrorOf>
      <name>阿里云公共仓库</name>
      <url>https://maven.aliyun.com/repository/public</url>
    </mirror>
  </mirrors>
  ```
- 在IDEA中刷新Maven项目

### 2. 数据库连接失败

**错误信息：** `Could not connect to database`

**解决方案：**
1. 确认MySQL服务已启动
   - Windows: 打开"服务"，找到MySQL服务
   - 或命令行：`net start mysql`

2. 检查 `application.properties` 配置
   - 数据库名称是否正确
   - 用户名密码是否正确
   - 端口是否为3306

3. 确认数据库已创建
   ```sql
   CREATE DATABASE IF NOT EXISTS book;
   ```

### 3. 端口被占用

**错误信息：** `Port 8081 was already in use`

**解决方案：**

**方法一：修改端口**
- 编辑 `application.properties`
- 修改 `server.port=8082`（改为其他端口）

**方法二：关闭占用端口的进程**
```bash
# Windows查找占用8081端口的进程
netstat -ano | findstr 8081

# 结束进程（PID是上一步查到的进程ID）
taskkill /F /PID <进程ID>
```

### 4. 前端启动失败

**错误信息：** `npm: command not found`

**解决方案：**
- 确认已安装Node.js
- 重新安装Node.js并重启IDEA
- 检查环境变量PATH中是否包含npm路径

### 5. 前端API请求失败

**错误信息：** `Network Error` 或 `CORS error`

**解决方案：**
1. 确认后端服务已启动（访问 http://localhost:8081/book 测试）
2. 检查 `CorsConfig.java` 配置是否正确
3. 清除浏览器缓存并刷新

### 6. MyBatis映射文件找不到

**错误信息：** `Invalid bound statement`

**解决方案：**
1. 检查 `application.properties` 中的配置：
   ```properties
   mybatis.mapper-locations=classpath:mapper/*.xml
   ```
2. 确认XML文件在 `src/main/resources/mapper/` 目录下
3. 重新编译项目：`Maven` → `Lifecycle` → `clean` → `compile`

### 7. 前端页面空白

**可能原因：**
- 后端服务未启动
- API接口返回错误

**解决方案：**
1. 打开浏览器开发者工具（F12）
2. 查看Console标签页的错误信息
3. 查看Network标签页检查API请求状态
4. 确认后端日志是否有异常

---

## 开发建议

### IDEA插件推荐

1. **Lombok** - 简化Java代码（如需要）
2. **MyBatis Log Plugin** - 查看SQL日志
3. **Vue.js** - Vue语法高亮
4. **GitToolBox** - Git增强工具

### 调试技巧

#### 后端调试

1. 在代码行号左侧点击，设置断点
2. 以Debug模式运行 `BookApplication`
3. 发送API请求，程序会在断点处暂停
4. 查看变量值、单步执行等

#### 前端调试

1. 在浏览器中按 `F12` 打开开发者工具
2. 在 `Sources` 标签页中找到Vue组件
3. 设置断点并刷新页面
4. 使用 `Vue DevTools` 浏览器插件（推荐）

### 代码规范

- **命名规范**：使用驼峰命名法
- **注释规范**：关键逻辑添加注释
- **日志规范**：使用SLF4J记录日志
- **异常处理**：捕获并处理异常

---

## 联系支持

如果遇到问题：

1. 查看本文档的"常见问题"章节
2. 查看IDEA控制台的错误日志
3. 查看浏览器开发者工具的Console
4. 检查数据库连接和数据

---

## 版本信息

- **项目版本**：1.0.0
- **Spring Boot**：3.5.8
- **Vue**：3.4.0
- **最后更新**：2025-12-05

---

**祝你开发愉快！** 🚀
